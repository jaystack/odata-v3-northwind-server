// JayData 1.5.9 
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki, Gábor Dolla
//
// More info: http://jaydata.org
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("jaydata/odata3",["jaydata/core"],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.$data=e()}}(function(){return function e(t,r,a){function n(o,s){if(!r[o]){if(!t[o]){var d="function"==typeof require&&require;if(!s&&d)return d(o,!0);if(i)return i(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[o]={exports:{}};t[o][0].call(p.exports,function(e){var r=t[o][1][e];return n(r?r:e)},p,p.exports,e,t,r,a)}return r[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)n(a[o]);return n}({1:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(r,"__esModule",{value:!0});var n=e("jaydata/core"),i=a(n),o=e("./oDataConverter.js"),s=(a(o),e("./oDataProvider.js")),d=(a(s),e("./oDataCompiler.js")),u=(a(d),e("./oDataWhereCompiler.js")),p=(a(u),e("./oDataOrderCompiler.js")),l=(a(p),e("./oDataPagingCompiler.js")),f=(a(l),e("./oDataProjectionCompiler.js"));a(f);r["default"]=i["default"],t.exports=r["default"]},{"./oDataCompiler.js":2,"./oDataConverter.js":3,"./oDataOrderCompiler.js":4,"./oDataPagingCompiler.js":5,"./oDataProjectionCompiler.js":6,"./oDataProvider.js":7,"./oDataWhereCompiler.js":8,"jaydata/core":"jaydata/core"}],2:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=a(n);(0,n.$C)("$data.storageProviders.oDataV3.oDataCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={},this.provider={},this.includes=null,this.mainEntitySet=null},compile:function(e){this.provider=e.context.storageProvider,this.context=e.context,e.defaultType&&(this.mainEntitySet=e.context.getEntitySetFromElementType(e.defaultType));var t={urlText:""};this.Visit(e.expression,t),e.modelBinderConfig={};var r=n.Container.createModelBinderConfigCompiler(e,this.includes,!0);r.Visit(e.expression);var a=t.urlText,i=!1;for(var o in t)"urlText"!=o&&"actionPack"!=o&&"data"!=o&&"lambda"!=o&&"method"!=o&&"postData"!=o&&"_isBatchExecuteQuery"!=o&&"_subQueries"!=o&&""!=t[o]&&(a+=i?"&":"?",i=!0,a+="$urlParams"!=o?o+"="+t[o]:t[o]);e.queryText=a,e.postData=t.postData;var s={queryText:a,withInlineCount:"$inlinecount"in t||"$count"in t,method:t.method||"GET",postData:t.postData,isBatchExecuteQuery:t._isBatchExecuteQuery,subQueries:t._subQueries,params:[]};return e._getComplitedData=function(){return s},s},VisitOrderExpression:function(e,t){this.Visit(e.source,t);var r=n.Container.createoDataOrderCompiler(this.provider);r.compile(e,t)},VisitPagingExpression:function(e,t){this.Visit(e.source,t);var r=n.Container.createoDataPagingCompiler(this.provider);r.compile(e,t)},VisitIncludeExpression:function(e,t){if(this.Visit(e.source,t),!t.$select){t.$expand?t.$expand+=",":t.$expand="",t.$expand+=e.selector.value.replace(/\./g,"/"),this.includes=this.includes||[];for(var r=e.selector.value.split("."),a=null,i=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew),o=0;o<r.length;o++){a?a+="."+r[o]:a=r[o];var s=i.Associations[r[o]];s?this.includes.some(function(e){return e.name==a},this)||this.includes.push({name:a,type:s.ToType}):n.Guard.raise(new n.Exception("The given include path is invalid: "+e.selector.value+", invalid point: "+a)),i=this.mainEntitySet.entityContext._storageModel.getStorageModel(s.ToType)}}},VisitFindExpression:function(e,t){if(this.Visit(e.source,t),t.urlText+="(",1===e.params.length){var r=e.params[0],a=n.Container.resolveName(r.type),i=this.provider.fieldConverter.toDb[a],o=i?i(r.value):r.value;i=this.provider.fieldConverter.escape[a],o=i?i(r.value):r.value,t.urlText+=o}else for(var s=0;s<e.params.length;s++){var r=e.params[s],a=n.Container.resolveName(r.type),i=this.provider.fieldConverter.toDb[a],o=i?i(r.value):r.value;i=this.provider.fieldConverter.escape[a],o=i?i(r.value):r.value,s>0&&(t.urlText+=","),t.urlText+=r.name+"="+o}t.urlText+=")"},VisitProjectionExpression:function(e,t){this.Visit(e.source,t);var r=n.Container.createoDataProjectionCompiler(this.context);r.compile(e,t)},VisitFilterExpression:function(e,t){this.Visit(e.source,t);var r=n.Container.createoDataWhereCompiler(this.provider);t.data="",r.compile(e.selector,t),t.$filter=t.data,t.data=""},VisitInlineCountExpression:function(e,t){this.Visit(e.source,t),"4.0"===this.provider.providerConfiguration.maxDataServiceVersion?t.$count="allpages"===e.selector.value:t.$inlinecount=e.selector.value},VisitEntitySetExpression:function(e,t){if(t.urlText+="/"+e.instance.tableName,e.params)for(var r=0;r<e.params.length;r++)this.Visit(e.params[r],t)},VisitServiceOperationExpression:function(e,t){if(e.boundItem&&(t.urlText+="/"+e.boundItem.entitySet.tableName,e.boundItem.data instanceof i["default"].Entity&&(t.urlText+="("+this.provider.getEntityKeysValue(e.boundItem)+")")),t.urlText+="/"+e.cfg.serviceName,t.method=t.method||e.cfg.method,e.params)for(var r=0;r<e.params.length;r++)this.Visit(e.params[r],t)},VisitBatchDeleteExpression:function(e,t){this.Visit(e.source,t),t.urlText+="/$batchDelete",t.method="DELETE"},VisitConstantExpression:function(e,t){var r=n.Container.resolveName(e.type);e.value instanceof i["default"].Entity&&(r=i["default"].Entity.fullName);var a=this.provider.fieldConverter.toDb[r],o=a?a(e.value):e.value;"GET"!==t.method&&t.method?(t.postData=t.postData||{},t.postData[e.name]=o):(a=this.provider.fieldConverter.escape[r],o=a?a(o):o,void 0!==o&&(t.$urlParams?t.$urlParams+="&":t.$urlParams="",t.$urlParams+=e.name+"="+o))},VisitCountExpression:function(e,t){this.Visit(e.source,t),t.urlText+="/$count"},VisitBatchExecuteQueryExpression:function(e,t){t.urlText+="/$batch",t.method="POST",t.postData={__batchRequests:[]},t._isBatchExecuteQuery=!0,t._subQueries=e.members;for(var r=0;r<e.members.length;r++){var a=e.members[r],n=new i["default"].storageProviders.oDataV3.oDataCompiler,o=n.compile(a);t.postData.__batchRequests.push({requestUri:o.queryText,method:o.method,data:o.data,headers:o.headers})}}},{})},{"jaydata/core":"jaydata/core"}],3:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i,o=e("jaydata/core"),s=a(o);s["default"].oDataConverterV3={fromDb:{"$data.Byte":s["default"].Container.proxyConverter,"$data.SByte":s["default"].Container.proxyConverter,"$data.Decimal":s["default"].Container.proxyConverter,"$data.Float":s["default"].Container.proxyConverter,"$data.Int16":s["default"].Container.proxyConverter,"$data.Int64":s["default"].Container.proxyConverter,"$data.ObjectID":s["default"].Container.proxyConverter,"$data.Integer":s["default"].Container.proxyConverter,"$data.Int32":s["default"].Container.proxyConverter,"$data.Number":s["default"].Container.proxyConverter,"$data.Date":function(e){return e?e instanceof Date?e:"/Date("===e.substring(0,6)?new Date(parseInt(e.substr(6))):(-1!==e.indexOf("Z")||e.match("T.*[+-]")||(e+="Z"),new Date(e)):e},"$data.DateTimeOffset":function(e){return e?e instanceof Date?e:"/Date("===e.substring(0,6)?new Date(parseInt(e.substr(6))):(-1!==e.indexOf("Z")||e.match("T.*[+-]")||(e+="Z"),new Date(e)):e},"$data.Time":s["default"].Container.proxyConverter,"$data.String":s["default"].Container.proxyConverter,"$data.Boolean":s["default"].Container.proxyConverter,"$data.Blob":function(e){if("string"!=typeof e)return e;try{return s["default"].Container.convertTo(atob(e),"$data.Blob")}catch(t){return e}},"$data.Object":function(e){return void 0===e?new s["default"].Object:"string"==typeof e?JSON.parse(e):e},"$data.Array":function(e){return void 0===e?new s["default"].Array:e instanceof s["default"].Array?e:JSON.parse(e)},"$data.GeographyPoint":function(e){return e?new s["default"].GeographyPoint(e):e},"$data.GeographyLineString":function(e){return e?new s["default"].GeographyLineString(e):e},"$data.GeographyPolygon":function(e){return e?new s["default"].GeographyPolygon(e):e},"$data.GeographyMultiPoint":function(e){return e?new s["default"].GeographyMultiPoint(e):e},"$data.GeographyMultiLineString":function(e){return e?new s["default"].GeographyMultiLineString(e):e},"$data.GeographyMultiPolygon":function(e){return e?new s["default"].GeographyMultiPolygon(e):e},"$data.GeographyCollection":function(e){return e?new s["default"].GeographyCollection(e):e},"$data.GeometryPoint":function(e){return e?new s["default"].GeometryPoint(e):e},"$data.GeometryLineString":function(e){return e?new s["default"].GeometryLineString(e):e},"$data.GeometryPolygon":function(e){return e?new s["default"].GeometryPolygon(e):e},"$data.GeometryMultiPoint":function(e){return e?new s["default"].GeometryMultiPoint(e):e},"$data.GeometryMultiLineString":function(e){return e?new s["default"].GeometryMultiLineString(e):e},"$data.GeometryMultiPolygon":function(e){return e?new s["default"].GeometryMultiPolygon(e):e},"$data.GeometryCollection":function(e){return e?new s["default"].GeometryCollection(e):e},"$data.Guid":function(e){return e?e.toString():e}},toDb:{"$data.Entity":s["default"].Container.proxyConverter,"$data.Byte":s["default"].Container.proxyConverter,"$data.SByte":s["default"].Container.proxyConverter,"$data.Decimal":s["default"].Container.proxyConverter,"$data.Float":s["default"].Container.proxyConverter,"$data.Int16":s["default"].Container.proxyConverter,"$data.Int64":s["default"].Container.proxyConverter,"$data.ObjectID":s["default"].Container.proxyConverter,"$data.Integer":s["default"].Container.proxyConverter,"$data.Int32":s["default"].Container.proxyConverter,"$data.Number":s["default"].Container.proxyConverter,"$data.Date":function(e){return e?e.toISOString().replace("Z",""):e},"$data.Time":s["default"].Container.proxyConverter,"$data.DateTimeOffset":function(e){return e?e.toISOString():e},"$data.String":s["default"].Container.proxyConverter,"$data.Boolean":s["default"].Container.proxyConverter,"$data.Blob":function(e){return e?s["default"].Blob.toBase64(e):e},"$data.Object":s["default"].Container.proxyConverter,"$data.Array":s["default"].Container.proxyConverter,"$data.GeographyPoint":s["default"].Container.proxyConverter,"$data.GeographyLineString":s["default"].Container.proxyConverter,"$data.GeographyPolygon":s["default"].Container.proxyConverter,"$data.GeographyMultiPoint":s["default"].Container.proxyConverter,"$data.GeographyMultiLineString":s["default"].Container.proxyConverter,"$data.GeographyMultiPolygon":s["default"].Container.proxyConverter,"$data.GeographyCollection":s["default"].Container.proxyConverter,"$data.GeometryPoint":s["default"].Container.proxyConverter,"$data.GeometryLineString":s["default"].Container.proxyConverter,"$data.GeometryPolygon":s["default"].Container.proxyConverter,"$data.GeometryMultiPoint":s["default"].Container.proxyConverter,"$data.GeometryMultiLineString":s["default"].Container.proxyConverter,"$data.GeometryMultiPolygon":s["default"].Container.proxyConverter,"$data.GeometryCollection":s["default"].Container.proxyConverter,"$data.Guid":s["default"].Container.proxyConverter},escape:{"$data.Entity":function(e){return JSON.stringify(e)},"$data.Integer":s["default"].Container.proxyConverter,"$data.Int32":s["default"].Container.proxyConverter,"$data.Number":s["default"].Container.proxyConverter,"$data.Int16":s["default"].Container.proxyConverter,"$data.Byte":s["default"].Container.proxyConverter,"$data.SByte":s["default"].Container.proxyConverter,"$data.Decimal":function(e){return e?e+"m":e},"$data.Float":function(e){return e?e+"f":e},"$data.Int64":function(e){return e?e+"L":e},"$data.Time":function(e){return e?"time'"+e+"'":e},"$data.DateTimeOffset":function(e){return e?"datetimeoffset'"+e+"'":e},"$data.Date":function(e){return e?"datetime'"+e+"'":e},"$data.String":function(e){return"string"==typeof e?"'"+e.replace(/'/g,"''")+"'":e},"$data.ObjectID":function(e){return"string"==typeof e?"'"+e.replace(/'/g,"''")+"'":e},"$data.Boolean":function(e){return"boolean"==typeof e?e.toString():e},"$data.Blob":function(e){return e?"X'"+s["default"].Blob.toHexString(s["default"].Container.convertTo(atob(e),s["default"].Blob))+"'":e},"$data.Object":function(e){return JSON.stringify(e)},"$data.Array":function(e){return JSON.stringify(e)},"$data.GeographyPoint":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyLineString":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyPolygon":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiPoint":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiLineString":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyMultiPolygon":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeographyCollection":function(e){return e?s["default"].GeographyBase.stringifyToUrl(e):e},"$data.GeometryPoint":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryLineString":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryPolygon":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiPoint":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiLineString":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryMultiPolygon":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.GeometryCollection":function(e){return e?s["default"].GeometryBase.stringifyToUrl(e):e},"$data.Guid":function(e){return e?"guid'"+e.toString()+"'":e}},unescape:{"$data.Entity":function(e,t){var r=t||{},a=JSON.parse(e);if(a&&r.type){var n=o.Container.resolveType(r.type);return new n(a,{converters:void 0})}return a},"$data.Number":function(e){return JSON.parse(e)},"$data.Integer":function(e){return JSON.parse(e)},"$data.Int32":function(e){return JSON.parse(e)},"$data.Byte":function(e){return JSON.parse(e)},"$data.SByte":function(e){return JSON.parse(e)},"$data.Decimal":function(e){return"string"==typeof e&&e.toLowerCase().lastIndexOf("m")===e.length-1?e.substr(0,e.length-1):e},"$data.Float":function(e){return"string"==typeof e&&e.toLowerCase().lastIndexOf("f")===e.length-1?e.substr(0,e.length-1):e},"$data.Int16":function(e){return JSON.parse(e)},"$data.Int64":function(e){return"string"==typeof e&&e.toLowerCase().lastIndexOf("l")===e.length-1?e.substr(0,e.length-1):e},"$data.Boolean":function(e){return JSON.parse(e)},"$data.Date":function(e){return"string"==typeof e&&/^datetime'/.test(e)?e.slice(9,e.length-1):e},"$data.String":function(e){return"string"==typeof e&&0===e.indexOf("'")&&e.lastIndexOf("'")===e.length-1?e.slice(1,e.length-1):e},"$data.ObjectID":function(e){return"string"==typeof e&&0===e.indexOf("'")&&e.lastIndexOf("'")===e.length-1?e.slice(1,e.length-1):e},"$data.Guid":function(e){if(/^guid'\w{8}-\w{4}-\w{4}-\w{4}-\w{12}'$/.test(e)){var t=e.slice(5,e.length-1);return s["default"].parseGuid(t).toString()}return e},"$data.Array":function(e,t){var r=t||{},a=JSON.parse(e)||[];if(a&&r.elementType){var n=o.Container.resolveType(r.elementType),i=o.Container.resolveName(n);if(n&&n.isAssignableTo&&n.isAssignableTo(s["default"].Entity)&&(i=s["default"].Entity.fullName),Array.isArray(a))for(var d=s["default"].oDataConverter.unescape[i],u=0;u<a.length;u++)a[u]=d?d(a[u]):a[u];return a}return a},"$data.DateTimeOffset":function(e){return"string"==typeof e&&/^datetimeoffset'/.test(e)?s["default"].Container.convertTo(e.slice(15,e.length-1),s["default"].DateTimeOffset):e},"$data.Time":function(e){return"string"==typeof e&&/^time'/.test(e)?s["default"].Container.convertTo(e.slice(5,e.length-1),s["default"].Time):e},"$data.Blob":function(e){if("string"==typeof e){if(/^X'/.test(e))return s["default"].Blob.createFromHexString(e.slice(2,e.length-1));if(/^binary'/.test(e))return s["default"].Blob.createFromHexString(e.slice(7,e.length-1))}return e},"$data.Object":function(e){return JSON.parse(e)},"$data.GeographyPoint":function(e){if(/^geography'POINT\(/i.test(e)){var t=e.slice(10,e.length-1);return s["default"].GeographyBase.parseFromString(t)}return e},"$data.GeographyPolygon":function(e){if(/^geography'POLYGON\(/i.test(e)){var t=e.slice(10,e.length-1);return s["default"].GeographyBase.parseFromString(t)}return e},"$data.GeometryPoint":function(e){if(/^geometry'POINT\(/i.test(e)){var t=e.slice(9,e.length-1);return s["default"].GeometryBase.parseFromString(t)}return e},"$data.GeometryPolygon":function(e){if(/^geometry'POLYGON\(/i.test(e)){var t=e.slice(9,e.length-1);return s["default"].GeometryBase.parseFromString(t)}return e}},xmlEscape:(i={"$data.Byte":function(e){return e.toString()},"$data.SByte":function(e){return e.toString()},"$data.Decimal":function(e){return e.toString()},"$data.Float":function(e){return e.toString()},"$data.Int16":function(e){return e.toString()},"$data.Int64":function(e){return e.toString()},"$data.Integer":function(e){return e.toString()},"$data.Int32":function(e){return e.toString()},"$data.Boolean":function(e){return e.toString()},"$data.Blob":function(e){return s["default"].Blob.toBase64(e)},"$data.Date":function(e){return e.toISOString().replace("Z","")},"$data.DateTimeOffset":function(e){return e.toISOString()},"$data.Time":function(e){return e.toString()},"$data.Number":function(e){return e.toString()}},n(i,"$data.Integer",function(e){return e.toString()}),n(i,"$data.Int32",function(e){return e.toString()}),n(i,"$data.String",function(e){return e.toString()}),n(i,"$data.ObjectID",function(e){return e.toString()}),n(i,"$data.Object",function(e){return JSON.stringify(e)}),n(i,"$data.Guid",function(e){return e.toString()}),i),simple:{"$data.Byte":function(e){return e.toString()},"$data.SByte":function(e){return e.toString()},"$data.Decimal":function(e){return e.toString()},"$data.Float":function(e){return e.toString()},"$data.Int16":function(e){return e.toString()},"$data.Int64":function(e){return e.toString()},"$data.ObjectID":function(e){return e.toString()},"$data.Integer":function(e){return e.toString()},"$data.Int32":function(e){return e.toString()},"$data.Number":function(e){return e.toString()},"$data.Date":function(e){return e instanceof s["default"].Date?e.toISOString().replace("Z",""):e.toString()},"$data.DateTimeOffset":function(e){return e?e.toISOString():e},"$data.Time":function(e){return e.toString()},"$data.String":function(e){return e.toString()},"$data.Boolean":function(e){return e.toString()},"$data.Blob":function(e){return e},"$data.Object":function(e){return JSON.stringify(e)},"$data.Array":function(e){return JSON.stringify(e)},"$data.Guid":function(e){return e.toString()},"$data.GeographyPoint":function(e){return JSON.stringify(e)},"$data.GeometryPoint":function(e){return JSON.stringify(e)},"$data.GeographyLineString":function(e){return JSON.stringify(e)},"$data.GeographyPolygon":function(e){return JSON.stringify(e)},"$data.GeographyMultiPoint":function(e){return JSON.stringify(e)},"$data.GeographyMultiLineString":function(e){return JSON.stringify(e)},"$data.GeographyMultiPolygon":function(e){return JSON.stringify(e)},"$data.GeographyCollection":function(e){return JSON.stringify(e)},"$data.GeometryLineString":function(e){return JSON.stringify(e)},"$data.GeometryPolygon":function(e){return JSON.stringify(e)},"$data.GeometryMultiPoint":function(e){return JSON.stringify(e)},"$data.GeometryMultiLineString":function(e){return JSON.stringify(e)},"$data.GeometryMultiPolygon":function(e){return JSON.stringify(e)},"$data.GeometryCollection":function(e){return JSON.stringify(e)}}}},{"jaydata/core":"jaydata/core"}],4:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=a(n);(0,n.$C)("$data.storageProviders.oDataV3.oDataOrderCompiler",i["default"].storageProviders.oDataV3.oDataWhereCompiler,null,{constructor:function(e){this.provider=e},compile:function(e,t){this.Visit(e,t)},VisitOrderExpression:function(e,t){var r={data:""};this.Visit(e.selector,r),t.$orderby?t.$orderby+=",":t.$orderby="",t.$orderby+=r.data+(e.nodeType==i["default"].Expressions.ExpressionType.OrderByDescending?" desc":"")},VisitParametricQueryExpression:function(e,t){this.Visit(e.expression,t)},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitComplexTypeExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t),t.data+="/"},VisitEntitySetExpression:function(e,t){e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&(this.Visit(e.source,t),this.Visit(e.selector,t))},VisitAssociationInfoExpression:function(e,t){t.data+=e.associationInfo.FromPropertyName+"/"},VisitEntityExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitMemberInfoExpression:function(e,t){t.data+=e.memberName},VisitEntityFieldOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var r=e.operation.memberDefinition,a=r.mapTo||r.name;t.data+=a,t.data+="(";var o=0,s=r.parameters||[{name:"@expression"}],d=s.map(function(t,r){return"@expression"===t.name?e.source:e.parameters[o++]});d.forEach(function(e,r){r>0&&(t.data+=","),this.Visit(e,t)},this),t.data+=")"},VisitEntityFunctionOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression),this.Visit(e.source,t);var r=e.operation.memberDefinition,a=r.mapTo||r.name;t.data+=a,t.data+="(";var o=0,s=r.method.params||[{name:"@expression"}],d=s.map(function(t,r){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;d.forEach(function(e,r){void 0===e||e instanceof i["default"].Expressions.ConstantExpression&&"undefined"==typeof e.value||(u>0&&(t.data+=","),u++,t.data+=s[r].name+"=",this.Visit(e,t))},this),t.data+=")"},VisitContextFunctionOperationExpression:function(e,t){return this.VisitEntityFunctionOperationExpression(e,t)}})},{"jaydata/core":"jaydata/core"}],5:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=a(n);(0,n.$C)("$data.storageProviders.oDataV3.oDataPagingCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.provider=e},compile:function(e,t){this.Visit(e,t)},VisitPagingExpression:function(e,t){var r={data:""};switch(this.Visit(e.amount,r),e.nodeType){case i["default"].Expressions.ExpressionType.Skip:t.$skip=r.data;break;case i["default"].Expressions.ExpressionType.Take:t.$top=r.data;break;default:n.Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(e,t){var r=n.Container.resolveName(e.type),a=this.provider.fieldConverter.escape[r];t.data+=a?a(e.value):e.value}})},{"jaydata/core":"jaydata/core"}],6:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=a(n);(0,n.$C)("$data.storageProviders.oDataV3.oDataProjectionCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e){this.entityContext=e,this.hasObjectLiteral=!1,this.ObjectLiteralPath="",this.modelBinderMapping=[]},compile:function(e,t){this.Visit(e,t)},VisitProjectionExpression:function(e,t){t.data="",this.mapping="",this.Visit(e.selector,t),t.$select?t.$select+=",":t.$select="",t.$select+=t.data,t.data=""},VisitParametricQueryExpression:function(e,t){if(this.Visit(e.expression,t),(e.expression instanceof i["default"].Expressions.EntityExpression||e.expression instanceof i["default"].Expressions.EntitySetExpression)&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/")),e.expression instanceof i["default"].Expressions.ComplexTypeExpression){var r=this.mapping.split(".");r.pop(),r.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=r.join("/"))}else{var r=this.mapping.split(".");r.pop(),r.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=r.join("/"))}},VisitObjectLiteralExpression:function(e,t){var r=this.ObjectLiteralPath;this.hasObjectLiteral=!0,e.members.forEach(function(r,a){this.Visit(r,t),a<e.members.length-1&&(t.data+=","),this.mapping=""},this),this.ObjectLiteralPath=r},VisitObjectFieldExpression:function(e,t){if(this.ObjectLiteralPath?this.ObjectLiteralPath+="."+e.fieldName:this.ObjectLiteralPath=e.fieldName,this.Visit(e.expression,t),e.expression instanceof i["default"].Expressions.EntityExpression||e.expression instanceof i["default"].Expressions.EntitySetExpression)t.$expand?t.$expand+=",":t.$expand="",t.$expand+=this.mapping.replace(/\./g,"/");else{var r=this.mapping.split(".");r.pop(),r.length>0&&(t.$expand?t.$expand+=",":t.$expand="",t.$expand+=r.join("/"))}},VisitComplexTypeExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),this.Visit(e.selector,t)},VisitEntityExpression:function(e,t){this.Visit(e.source,t)},VisitEntitySetExpression:function(e,t){e.source instanceof i["default"].Expressions.EntityExpression&&this.Visit(e.source,t),e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&this.Visit(e.selector,t)},VisitAssociationInfoExpression:function(e,t){t.data&&t.data.length>0&&","!=t.data[t.data.length-1]&&(t.data+="/"),t.data+=e.associationInfo.FromPropertyName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=e.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(e,t){t.data&&t.data.length>0&&","!=t.data[t.data.length-1]&&(t.data+="/"),t.data+=e.memberName,this.mapping&&this.mapping.length>0&&(this.mapping+="."),this.mapping+=e.memberName},VisitConstantExpression:function(e,t){t.data=t.data.slice(0,t.data.length-1)}})},{"jaydata/core":"jaydata/core"}],7:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("jaydata/core"),s=a(o);n=function(e){if(e&&e.jsonHandler&&"useJsonLight"in e.jsonHandler&&"object"===("undefined"==typeof datajs?"undefined":i(datajs))&&!datajs.version){s["default"].Trace.log("!!!!!!! - patch datajs 1.1.0");var t=e.defaultHandler.read;e.defaultHandler.read=function(e,r){delete r.contentType,delete r.dataServiceVersion,t.apply(this,arguments)};var r=e.defaultHandler.write;e.defaultHandler.write=function(e,t){delete t.contentType,delete t.dataServiceVersion,r.apply(this,arguments)}}n=function(){}},(0,o.$C)("$data.storageProviders.oDataV3.oDataProvider",s["default"].StorageProviderBase,null,{constructor:function(e,t){this.SqlCommands=[],this.context=t,this.providerConfiguration=s["default"].typeSystem.extend({dbCreation:s["default"].storageProviders.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"2.0",dataServiceVersion:void 0,setDataServiceVersionToMax:!0,user:null,password:null,withCredentials:!1,UpdateMethod:"PATCH"},e),"4.0"===this.providerConfiguration.maxDataServiceVersion?"undefined"==typeof odatajs||"undefined"==typeof odatajs.oData?o.Guard.raise(new o.Exception("odatajs is required","Not Found!")):this.oData=odatajs.oData:"undefined"==typeof OData?o.Guard.raise(new o.Exception("datajs is required","Not Found!")):(this.oData=OData,n(this.oData)),this.fixkDataServiceVersions(e),this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction),this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},fixkDataServiceVersions:function(e){this.providerConfiguration.dataServiceVersion>this.providerConfiguration.maxDataServiceVersion&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.setDataServiceVersionToMax===!0&&(this.providerConfiguration.dataServiceVersion=this.providerConfiguration.maxDataServiceVersion),(e&&!e.UpdateMethod&&this.providerConfiguration.dataServiceVersion<"3.0"||!this.providerConfiguration.dataServiceVersion)&&(this.providerConfiguration.UpdateMethod="MERGE")},initializeStore:function(e){switch(e=s["default"].typeSystem.createCallbackSetting(e),this.providerConfiguration.dbCreation){case s["default"].storageProviders.DbCreationType.DropAllExistingTables:var t=this;if(this.providerConfiguration.serviceUrl){var r=[{requestUri:t.providerConfiguration.serviceUrl+"/Delete",method:"POST"},function(r){e.success(t.context)},function(r){e.success(t.context)}];this.appendBasicAuth(r[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,r),this.oData.request.apply(this,r)}else e.success(t.context);break;default:e.success(this.context)}},buildDbType_generateConvertToFunction:function(e,t){return function(r,a){var n=new e.PhysicalType;return n.entityState=r.entityState,e.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(e){n.initData[e.name]=r[e.name]},this),e.Associations&&e.Associations.forEach(function(e){if("*"==e.FromMultiplicity&&"0..1"==e.ToMultiplicity||"0..1"==e.FromMultiplicity&&"1"==e.ToMultiplicity||"$$unbound"==e.FromMultiplicity){var i=r[e.FromPropertyName];if(void 0!==i)if(i instanceof s["default"].Array)n.initData[e.FromPropertyName]=n[e.FromPropertyName]||[],i.forEach(function(r){if(r.entityState==s["default"].EntityState.Modified||a.indexOf(r)<0){var i=t._storageModel.getStorageModel(r.getType()),d=i.TableName,u="("+t.storageProvider.getEntityKeysValue({data:r,entitySet:t.getEntitySetFromElementType(r.getType())})+")";n.initData[e.FromPropertyName].push({__metadata:{uri:d+u}})}else{var p=a.indexOf(r);0>p&&o.Guard.raise("Dependency graph error"),n.initData[e.FromPropertyName].push({__metadata:{uri:"$"+(p+1)}})}},this);else if(null===i)n.initData[e.FromPropertyName]=null;else if(i.entityState==s["default"].EntityState.Modified||a.indexOf(i)<0){var d=t._storageModel.getStorageModel(i.getType()),u=d.TableName,p="("+t.storageProvider.getEntityKeysValue({data:i,entitySet:t.getEntitySetFromElementType(i.getType())})+")";n.initData[e.FromPropertyName]={__metadata:{uri:u+p}}}else{var l=a.indexOf(i);0>l&&o.Guard.raise("Dependency graph error"),n.initData[e.FromPropertyName]={__metadata:{uri:"$"+(l+1)}}}}},this),e.ComplexTypes&&e.ComplexTypes.forEach(function(e){n.initData[e.FromPropertyName]=r[e.FromPropertyName]},this),n}},buildDbType_modifyInstanceDefinition:function(){},executeQuery:function(e,t){t=s["default"].typeSystem.createCallbackSetting(t);var r={};try{r=this._compile(e)}catch(a){return void t.error(a)}var n=(this.context,this),d="__count";"4.0"===this.providerConfiguration.maxDataServiceVersion&&(d="@odata.count");var u=[{requestUri:this.providerConfiguration.oDataServiceHost+r.queryText,method:r.method,data:r.postData,headers:{}},function(a,u,p){if(a||!u.body||r.isBatchExecuteQuery||(a=JSON.parse(u.body)),t.success){var l=function(e,t,r){e.rawDataList="string"==typeof t?[{cnt:o.Container.convertTo(t,s["default"].Integer)}]:t,r.withInlineCount&&"object"===("undefined"==typeof t?"undefined":i(t))&&("undefined"!=typeof t[d]||"d"in t&&"undefined"!=typeof t.d[d])&&(e.__count=new Number("undefined"!=typeof t[d]?t[d]:t.d[d]).valueOf())};if(r.isBatchExecuteQuery){e.rawDataList=r.subQueries;for(var f=0;f<a.__batchResponses.length;f++){var c=a.__batchResponses[f];if(!c.data){if(!c.body)return void t.error(n.parseError(c,arguments));c.data=JSON.parse(c.body)}l(r.subQueries[f],c.data,r.subQueries[f]._getComplitedData());
}}else l(e,a,r);t.success(e)}},function(e){t.error(n.parseError(e,arguments))},r.isBatchExecuteQuery?this.oData.batchHandler:void 0];this.providerConfiguration.maxDataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(u[0].headers.MaxDataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.dataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(u[0].headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion),"undefined"!=typeof this.providerConfiguration.enableJSONP&&(u[0].enableJsonpCallback=this.providerConfiguration.enableJSONP),"undefined"!=typeof this.providerConfiguration.useJsonLight&&(u[0].useJsonLight=this.providerConfiguration.useJsonLight),this.appendBasicAuth(u[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,u),this.oData.request.apply(this,u)},_compile:function(e,t){var r=new s["default"].storageProviders.oDataV3.oDataCompiler,a=r.compile(e);return a},saveChanges:function(e,t){if(t.length>0){var r=this.buildIndependentBlocks(t);this.saveInternal(r,0,e)}else e.success(0)},saveInternal:function(e,t,r){(this.providerConfiguration.disableBatch===!0||"object"===i(s["default"].defaults)&&s["default"].defaults.disableBatch===!0)&&"function"==typeof this._saveRestMany?this._saveRestMany(e,t,r):e.length>1||1==e.length&&e[0].length>1?this._saveBatch(e,t,r):this._saveRest(e,t,r)},_saveRest:function(e,t,r){for(var a,n=[],i=0;i<e.length;i++)for(var d=0;d<e[i].length;d++)switch(n.push(e[i][d].data),a={requestUri:this.providerConfiguration.oDataServiceHost+"/",headers:{}},this.providerConfiguration.maxDataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(a.headers.MaxDataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.dataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(a.headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion),"undefined"!=typeof this.providerConfiguration.useJsonLight&&(a.useJsonLight=this.providerConfiguration.useJsonLight),e[i][d].data.entityState){case s["default"].EntityState.Unchanged:continue;case s["default"].EntityState.Added:a.method="POST",a.requestUri+=e[i][d].entitySet.tableName,a.data=this.save_getInitData(e[i][d],n);break;case s["default"].EntityState.Modified:a.method=this.providerConfiguration.UpdateMethod,a.requestUri+=e[i][d].entitySet.tableName,a.requestUri+="("+this.getEntityKeysValue(e[i][d])+")",this.save_addConcurrencyHeader(e[i][d],a.headers),a.data=this.save_getInitData(e[i][d],n);break;case s["default"].EntityState.Deleted:a.method="DELETE",a.requestUri+=e[i][d].entitySet.tableName,a.requestUri+="("+this.getEntityKeysValue(e[i][d])+")",this.save_addConcurrencyHeader(e[i][d],a.headers);break;default:o.Guard.raise(new o.Exception("Not supported Entity state"))}var u=this,p=[a,function(e,t){if(t.statusCode>=200&&t.statusCode<300){var a=n[0];if(204==t.statusCode){if(t.headers.ETag||t.headers.Etag||t.headers.etag){var i=a.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===s["default"].ConcurrencyMode.Fixed});i&&i[0]&&(a[i[0].name]=t.headers.ETag||t.headers.Etag||t.headers.etag)}}else u.reload_fromResponse(a,e,t);r.success&&r.success(n.length)}else r.error(u.parseError(t))},function(e){r.error(u.parseError(e))}];this.appendBasicAuth(p[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,p),this.oData.request.apply(this,p)},_saveBatch:function(e,t,r){for(var a=[],n=[],i=0;i<e.length;i++)for(var d=0;d<e[i].length;d++){n.push(e[i][d].data);var u={};switch(u.headers={"Content-Id":n.length},"4.0"!=this.providerConfiguration.maxDataServiceVersion&&(u.headers.MaxDataServiceVersion=this.providerConfiguration.maxDataServiceVersion),e[i][d].data.entityState){case s["default"].EntityState.Unchanged:continue;case s["default"].EntityState.Added:u.method="POST",u.requestUri=e[i][d].entitySet.tableName,u.data=this.save_getInitData(e[i][d],n);break;case s["default"].EntityState.Modified:u.method=this.providerConfiguration.UpdateMethod,u.requestUri=e[i][d].entitySet.tableName,u.requestUri+="("+this.getEntityKeysValue(e[i][d])+")",this.save_addConcurrencyHeader(e[i][d],u.headers),u.data=this.save_getInitData(e[i][d],n);break;case s["default"].EntityState.Deleted:u.method="DELETE",u.requestUri=e[i][d].entitySet.tableName,u.requestUri+="("+this.getEntityKeysValue(e[i][d])+")",this.save_addConcurrencyHeader(e[i][d],u.headers);break;default:o.Guard.raise(new o.Exception("Not supported Entity state"))}this.providerConfiguration.maxDataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(u.headers.MaxDataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.dataServiceVersion&&"4.0"!==this.providerConfiguration.maxDataServiceVersion&&(u.headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion),a.push(u)}var p=this,l=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:a}]},headers:{}},function(e,t){if(202==t.statusCode){for(var a=e.__batchResponses[0].__changeResponses,i=[],d=0;d<a.length;d++)if(a[d].statusCode>=200&&a[d].statusCode<300){var u=n[d];if(204==a[d].statusCode){if(a[d].headers.ETag||a[d].headers.Etag||a[d].headers.etag){var l=u.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===s["default"].ConcurrencyMode.Fixed});l&&l[0]&&(u[l[0].name]=a[d].headers.ETag||a[d].headers.Etag||a[d].headers.etag)}continue}p.reload_fromResponse(u,a[d].data,a[d])}else i.push(p.parseError(a[d]));i.length>0?1===i.length?r.error(i[0]):r.error(new o.Exception("See inner exceptions","Batch failed",i)):r.success&&r.success(n.length)}else r.error(p.parseError(t))},function(e){r.error(p.parseError(e))},this.oData.batchHandler];this.providerConfiguration.maxDataServiceVersion&&"4.0"!=this.providerConfiguration.maxDataServiceVersion&&(l[0].headers.MaxDataServiceVersion=this.providerConfiguration.maxDataServiceVersion),this.providerConfiguration.dataServiceVersion&&"4.0"!=this.providerConfiguration.maxDataServiceVersion&&(l[0].headers.DataServiceVersion=this.providerConfiguration.dataServiceVersion),"undefined"!=typeof this.providerConfiguration.useJsonLight&&(l[0].useJsonLight=this.providerConfiguration.useJsonLight),this.appendBasicAuth(l[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials),this.context.prepareRequest.call(this,l),this.oData.request.apply(this,l)},reload_fromResponse:function(e,t,r){var a=this;e.getType().memberDefinitions.getPublicMappedProperties().forEach(function(n){var i=o.Container.resolveType(n.type);if(n.computed||n.key||!n.inverseProperty)if(n.concurrencyMode===s["default"].ConcurrencyMode.Fixed)e[n.name]=r.headers.ETag||r.headers.Etag||r.headers.etag;else if(n.isAssignableTo)t[n.name]?e[n.name]=new i(t[n.name],{converters:a.fieldConverter.fromDb}):e[n.name]=t[n.name];else if(i===s["default"].Array&&n.elementType){var d=o.Container.resolveType(n.elementType);if(t[n.name]&&Array.isArray(t[n.name])){for(var u=[],p=0;p<t[n.name].length;p++){var l=t[n.name][p];if(d.isAssignableTo&&!Object.isNullOrUndefined(l))u.push(new d(l,{converters:a.fieldConverter.fromDb}));else{var f=o.Container.resolveName(d),c=a.fieldConverter.fromDb[f];u.push(c?c(l):l)}}e[n.name]=u}else t[n.name]||(e[n.name]=t[n.name])}else{var y=o.Container.resolveName(n.type),m=a.fieldConverter.fromDb[y];e[n.name]=m?m(t[n.name]):t[n.name]}},this)},save_getInitData:function(e,t,r,a){var n=this;r?e.physicalData=e.data:e.physicalData=this.context._storageModel.getStorageModel(e.data.getType()).PhysicalType.convertTo(e.data,t);var i={};return e.physicalData.getType().memberDefinitions.asArray().forEach(function(r){if(r.kind==s["default"].MemberTypes.complexProperty&&e.physicalData[r.name])i[r.name]=n.save_getInitData({data:e.physicalData[r.name]},t,!0,!0);else if((r.kind==s["default"].MemberTypes.navProperty||r.kind==s["default"].MemberTypes.property&&!r.notMapped)&&(a||"undefined"==typeof r.concurrencyMode&&(r.key===!0||e.data.entityState===s["default"].EntityState.Added||e.data.changedProperties&&e.data.changedProperties.some(function(e){return e.name===r.name}))))if(r.kind==s["default"].MemberTypes.navProperty&&e.physicalData[r.name]&&"4.0"===this.providerConfiguration.maxDataServiceVersion)i[r.name+"@odata.bind"]=e.physicalData[r.name].__metadata.uri;else{var d=o.Container.resolveName(r.type),u=n.fieldConverter.toDb[d];i[r.name]=u?u(e.physicalData[r.name]):e.physicalData[r.name]}},this),i},save_addConcurrencyHeader:function(e,t){var r=e.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(e){return e.concurrencyMode===s["default"].ConcurrencyMode.Fixed});r&&r[0]&&(t["If-Match"]=e.data[r[0].name])},getTraceString:function(e){this._compile(e);return e},supportedDataTypes:{value:[s["default"].Array,s["default"].Integer,s["default"].String,s["default"].Number,s["default"].Blob,s["default"].Boolean,s["default"].Date,s["default"].Object,s["default"].GeographyPoint,s["default"].Guid,s["default"].GeographyLineString,s["default"].GeographyPolygon,s["default"].GeographyMultiPoint,s["default"].GeographyMultiLineString,s["default"].GeographyMultiPolygon,s["default"].GeographyCollection,s["default"].GeometryPoint,s["default"].GeometryLineString,s["default"].GeometryPolygon,s["default"].GeometryMultiPoint,s["default"].GeometryMultiLineString,s["default"].GeometryMultiPolygon,s["default"].GeometryCollection,s["default"].Byte,s["default"].SByte,s["default"].Decimal,s["default"].Float,s["default"].Int16,s["default"].Int32,s["default"].Int64,s["default"].Time,s["default"].DateTimeOffset],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},divide:{mapTo:"div",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},multiply:{mapTo:"mul",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:[{allowedType:"string",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},{allowedType:"GeographyLineString",mapTo:"geo.length",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:["GeographyLineString"]}],fixedDataType:"decimal"},{allowedType:"GeometryLineString",mapTo:"geo.length",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryLineString"}],fixedDataType:"decimal"}],strLength:{mapTo:"length",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},month:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},distance:[{allowedType:"GeographyPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"to",dataType:"GeographyPoint"}],fixedDataType:"decimal"},{allowedType:"GeometryPoint",mapTo:"geo.distance",dataType:"number",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"to",dataType:"GeometryPoint"}],fixedDataType:"decimal"}],intersects:[{allowedType:"GeographyPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeographyPoint"},{name:"in",dataType:"GeographyPolygon"}]},{allowedType:"GeometryPoint",mapTo:"geo.intersects",dataType:"boolean",allowedIn:[s["default"].Expressions.FilterExpression,s["default"].Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"GeometryPoint"},{name:"in",dataType:"GeometryPolygon"}]}]},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[s["default"].Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:s["default"].Expressions.SomeExpression},every:{invokable:!1,allowedIn:[s["default"].Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"all",frameType:s["default"].Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{},batchDelete:{},withInlineCount:{},find:{}},enumerable:!0,writable:!0},supportedContextOperation:{value:{batchExecuteQuery:!0},enumerable:!0,writable:!0},fieldConverter:{value:s["default"].oDataConverterV3},resolveTypeOperations:function(e,t,r){var a=t.entityType.getMemberDefinition(e);return a&&a.method&&a.method.IsSideEffecting===!1&&a.method.returnType&&(r===s["default"].Expressions.FilterExpression||r===s["default"].Expressions.OrderExpression)||o.Guard.raise(new o.Exception("Entity '"+t.entityType.name+"' Operation '"+e+"' is not supported by the provider")),a},resolveSetOperations:function(e,t,r){if(t){var a=t.storageModel.ContextType.getMemberDefinition(t.storageModel.ItemName);if(a&&a.actions&&a.actions[e]){var n=s["default"].MemberDefinition.translateDefinition(a.actions[e],e,this.getType());return n&&n.method&&n.method.IsSideEffecting===!1&&n.method.returnType&&(r===s["default"].Expressions.FilterExpression||r===s["default"].Expressions.OrderExpression)||o.Guard.raise(new o.Exception("Collection '"+t.storageModel.ItemName+"' Operation '"+e+"' is not supported by the provider")),n}}return s["default"].StorageProviderBase.prototype.resolveSetOperations.apply(this,arguments)},resolveContextOperations:function(e,t,r){var a=this.context.getType().getMemberDefinition(e);return a&&a.method&&a.method.IsSideEffecting===!1&&a.method.returnType&&(r===s["default"].Expressions.FilterExpression||r===s["default"].Expressions.OrderExpression)||o.Guard.raise(new o.Exception("Context '"+t.instance.getType().name+"' Operation '"+e+"' is not supported by the provider")),a},getEntityKeysValue:function(e){for(var t=[],r=void 0,a=e.data.getType().memberDefinitions.getKeyProperties(),n=0,i=a.length;i>n;n++){var s=a[n];if(s.key){r=e.data[s.name];var d=o.Container.resolveName(s.type),u=this.fieldConverter.toDb[d];r=u?u(r):r,u=this.fieldConverter.escape[d],r=u?u(r):r,t.push(s.name+"="+r)}}return t.length>1?t.join(","):r},getFieldUrl:function(e,t,r){var a=this.getEntityKeysValue({data:e}),n=this.providerConfiguration.oDataServiceHost;return n.lastIndexOf("/")===n.length&&(n=n.substring(0,n.length-1)),n+"/"+r.tableName+"("+a+")/"+t+"/$value"},parseError:function(e,t){var r=(e.response||e||{}).body||"";try{if(0===r.indexOf("{")){var a=JSON.parse(r);a=a["odata.error"]||a.error||a,a.message&&(r=a.message.value||a.message)}}catch(n){}return new o.Exception(r,e.message,t||e)},appendBasicAuth:function(e,t,r,a){e.headers=e.headers||{},!e.headers.Authorization&&t&&r&&(e.headers.Authorization="Basic "+this.__encodeBase64(t+":"+r)),a&&(e.withCredentials=a)},__encodeBase64:function(e){var t,r,a,n,i,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=e,d="",u="",p="",l=0;do t=s.charCodeAt(l++),r=s.charCodeAt(l++),u=s.charCodeAt(l++),a=t>>2,n=(3&t)<<4|r>>4,i=(15&r)<<2|u>>6,p=63&u,isNaN(r)?i=p=64:isNaN(u)&&(p=64),d=d+o.charAt(a)+o.charAt(n)+o.charAt(i)+o.charAt(p),t=r=u="",a=n=i=p="";while(l<s.length);return d}},null),s["default"].StorageProviderBase.registerProvider("oDataV3",s["default"].storageProviders.oDataV3.oDataProvider)},{"jaydata/core":"jaydata/core"}],8:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var n=e("jaydata/core"),i=a(n);(0,n.$C)("$data.storageProviders.oDataV3.oDataWhereCompiler",i["default"].Expressions.EntityExpressionVisitor,null,{constructor:function(e,t){this.provider=e,this.lambdaPrefix=t},compile:function(e,t){this.Visit(e,t)},VisitParametricQueryExpression:function(e,t){this.Visit(e.expression,t)},VisitUnaryExpression:function(e,t){t.data+=e.resolution.mapTo,t.data+="(",this.Visit(e.operand,t),t.data+=")"},VisitSimpleBinaryExpression:function(e,t){if(t.data+="(","in"==e.nodeType){n.Guard.requireType("expression.right",e.type,i["default"].Expressions.ConstantExpression);var r=e.right.value;!r instanceof Array&&n.Guard.raise(new n.Exception("Right to the 'in' operator must be an array value"));var a=null,o={mapTo:"or",dataType:"boolean",name:"or"},s={mapTo:"eq",dataType:"boolean",name:"equal"};r.forEach(function(t){var r=t,d=n.Container.createSimpleBinaryExpression(e.left,r,i["default"].Expressions.ExpressionType.Equal,"==","boolean",s);a=a?n.Container.createSimpleBinaryExpression(a,d,i["default"].Expressions.ExpressionType.Or,"||","boolean",o):d});var d=t.data;t.data="",this.Visit(a,t),t.data=d+t.data.replace(/\(/g,"").replace(/\)/g,"")}else this.Visit(e.left,t),t.data+=" ",t.data+=e.resolution.mapTo,t.data+=" ",this.Visit(e.right,t);t.data+=")"},VisitEntityFieldExpression:function(e,t){this.Visit(e.source,t),e.source instanceof i["default"].Expressions.ComplexTypeExpression&&(t.data+="/"),this.Visit(e.selector,t)},VisitAssociationInfoExpression:function(e,t){t.data+=e.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(e,t){t.data+=e.memberName},VisitQueryParameterExpression:function(e,t){var r=n.Container.resolveName(e.type),a=this.provider.fieldConverter.toDb[r],i=a?a(e.value):e.value;a=this.provider.fieldConverter.escape[r],t.data+=a?a(i):i},VisitEntityFieldOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var r=e.operation.memberDefinition,a=r.mapTo||r.name;t.data+=a,t.data+="(";var o=0,s=r.parameters||[{name:"@expression"}],d=s.map(function(t,r){return"@expression"===t.name?e.source:e.parameters[o++]});d.forEach(function(e,r){r>0&&(t.data+=","),this.Visit(e,t)},this),t.data+=")"},VisitEntityFunctionOperationExpression:function(e,t){n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression),this.Visit(e.source,t);var r=e.operation.memberDefinition,a=r.mapTo||r.name;t.data+=a,t.data+="(";var o=0,s=r.method.params||[{name:"@expression"}],d=s.map(function(t,r){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;d.forEach(function(e,r){void 0===e||e instanceof i["default"].Expressions.ConstantExpression&&"undefined"==typeof e.value||(u>0&&(t.data+=","),u++,t.data+=s[r].name+"=",this.Visit(e,t))},this),t.data+=")"},VisitContextFunctionOperationExpression:function(e,t){return this.VisitEntityFunctionOperationExpression(e,t)},VisitConstantExpression:function(e,t){var r=n.Container.resolveName(e.type),a=this.provider.fieldConverter.toDb[r],i=a?a(e.value):e.value;a=this.provider.fieldConverter.escape[r],t.data+=a?a(i):i},VisitEntityExpression:function(e,t){this.Visit(e.source,t),this.lambdaPrefix&&e.selector.lambda&&(t.lambda=e.selector.lambda,t.data+=e.selector.lambda+"/")},VisitEntitySetExpression:function(e,t){this.Visit(e.source,t),e.selector instanceof i["default"].Expressions.AssociationInfoExpression&&(this.Visit(e.selector,t),t.data+="/")},VisitFrameOperationExpression:function(e,t){this.Visit(e.source,t),n.Guard.requireType("expression.operation",e.operation,i["default"].Expressions.MemberInfoExpression);var r=e.operation.memberDefinition,a=r.mapTo||r.name;t.data+=a,t.data+="(";for(var o=0,s=r.parameters||[{name:"@expression"}],d=s.map(function(t,r){return"@expression"===t.name?e.source:e.parameters[o++]}),u=0;u<d.length;u++){var p=d[u];if(p&&p.value instanceof i["default"].Queryable){var l=new r.frameType(p.value.expression),f=n.Container.createQueryExpressionCreator(p.value.entityContext),c=f.Visit(l),y=new i["default"].storageProviders.oDataV3.oDataWhereCompiler(this.provider,!0),m={data:""};y.compile(c,m);t.data+=m.lambda+": "+m.data}}t.data+=")"}})},{"jaydata/core":"jaydata/core"}]},{},[1])(1)});
//# sourceMappingURL=oDataProviderV3.min.js.map
